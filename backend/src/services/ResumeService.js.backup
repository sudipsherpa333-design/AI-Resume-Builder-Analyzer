import Resume from '../models/Resume.js';

class ResumeService {
    
    async createResume(resumeData, userId) {
        try {
            console.log('üìù Creating resume for user:', userId);
            console.log('üì¶ Resume data:', resumeData);
            
            const resume = new Resume({
                ...resumeData,
                user: userId
            });
            
            const savedResume = await resume.save();
            console.log('‚úÖ Resume saved with ID:', savedResume._id);
            
            return {
                success: true,
                data: savedResume
            };
        } catch (error) {
            console.error('‚ùå Error creating resume:', error);
            return {
                success: false,
                error: error.message,
                stack: error.stack
            };
        }
    }
    
    async getUserResumes(userId) {
        try {
            const resumes = await Resume.find({ user: userId })
                .sort({ createdAt: -1 });
            
            return {
                success: true,
                data: resumes,
                count: resumes.length
            };
        } catch (error) {
            return {
                success: false,
                error: error.message
            };
        }
    }
    
    async getResumeById(resumeId, userId) {
        try {
            const resume = await Resume.findOne({
                _id: resumeId,
                user: userId
            });
            
            if (!resume) {
                return {
                    success: false,
                    error: 'Resume not found'
                };
            }
            
            return {
                success: true,
                data: resume
            };
        } catch (error) {
            return {
                success: false,
                error: error.message
            };
        }
    }
    
    async updateResume(resumeId, userId, updateData) {
        try {
            const resume = await Resume.findOneAndUpdate(
                { _id: resumeId, user: userId },
                { ...updateData, updatedAt: new Date() },
                { new: true, runValidators: true }
            );
            
            if (!resume) {
                return {
                    success: false,
                    error: 'Resume not found'
                };
            }
            
            return {
                success: true,
                data: resume
            };
        } catch (error) {
            return {
                success: false,
                error: error.message
            };
        }
    }
    
    async deleteResume(resumeId, userId) {
        try {
            const resume = await Resume.findOneAndDelete({
                _id: resumeId,
                user: userId
            });
            
            if (!resume) {
                return {
                    success: false,
                    error: 'Resume not found'
                };
            }
            
            return {
                success: true,
                message: 'Resume deleted successfully'
            };
        } catch (error) {
            return {
                success: false,
                error: error.message
            };
        }
    }
}

export default new ResumeService();
